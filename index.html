<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>日報入力</title>

    <style>
      body {
        margin: 0;
        font-family: "Segoe UI", sans-serif;
        background: #9ec7e8;
      }

      .header {
        background: linear-gradient(#e6f2ff, #9ec7e8);
        padding: 12px;
        text-align: center;
        font-size: 28px;
        font-weight: bold;
      }

      .container {
        max-width: 1200px;
        margin: auto;
        padding: 15px;
      }

      .info {
        display: grid;
        grid-template-columns: 100px 1fr;
        gap: 8px;
        margin-bottom: 10px;
      }

      .label {
        background: #eee;
        padding: 8px;
        text-align: center;
        font-weight: bold;
      }

      .input {
        background: #ffeaa7;
        padding: 8px;
        min-height: 20px;
      }

      .names {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin: 10px 0;
      }

      .names button {
        padding: 6px 14px;
        border: none;
        background: #bfbfbf;
        border-radius: 4px;
        cursor: pointer;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        background: #fff;
      }

      th,
      td {
        border: 2px solid #d6a200;
        padding: 4px;
        text-align: center;
      }

      th {
        background: #f5e6b8;
      }

      td textarea {
        width: 100%;
        height: 40px;
        background: #e8f5e3;
        border: none;
        resize: none;
      }

      td input,
      td select {
        width: 100%;
        height: 30px;
      }

      .buttons {
        margin-top: 15px;
        display: flex;
        gap: 10px;
      }

      .buttons button {
        padding: 10px 22px;
        border: none;
        font-size: 16px;
        cursor: pointer;
        border-radius: 5px;
      }

      .btn-reset {
        background: #bdc3c7;
      }
      .btn-submit {
        background: #f39c12;
        color: #fff;
      }
      .btn-admin {
        background: #2c3e50;
        color: #fff;
      }
    </style>
  </head>

  <body>
    <div class="header">日報入力</div>

    <form id="nippoForm">
      <input type="hidden" id="hiddenNamae" />
      <input type="hidden" id="hiddenDate" />

      <div class="container">
        <div class="info">
          <div class="label">名前</div>
          <div class="input" id="nameBox"></div>

          <div class="label">日付</div>
          <div class="input">
            <input type="date" id="dateInput" />
          </div>
        </div>

        <div class="names">
          <button type="button" onclick="setName('冨永')">冨永</button>
          <button type="button" onclick="setName('遠藤')">遠藤</button>
          <button type="button" onclick="setName('ダン')">ダン</button>
          <button type="button" onclick="setName('マイン')">マイン</button>
          <button type="button" onclick="setName('ダット')">ダット</button>
          <button type="button" onclick="setName('ヒエウ')">ヒエウ</button>
          <button type="button" onclick="setName('タン')">タン</button>
          <button type="button" onclick="setName('アン')">アン</button>
          <button type="button" onclick="setName('ヴォン')">ヴォン</button>
        </div>

        <table>
          <tr>
            <th>社内番号</th>
            <th>内容</th>
            <th>機械</th>
            <th>時間</th>
          </tr>
          <tbody id="tableBody"></tbody>
        </table>

        <div class="buttons">
          <button type="button" class="btn-reset" onclick="resetForm()">
            RESET
          </button>
          <button type="button" class="btn-submit" onclick="submitNippo()">
            入力
          </button>
          <button type="button" class="btn-admin" onclick="adminLogin()">
            管理人
          </button>
        </div>
      </div>
    </form>

    <script>
      /* -----------------------------
         MOCK DATA (GIỐNG THẬT)
      ------------------------------*/

      const mockWork = [
        { shanaibango: "A001", hinmei: "部品加工" },
        { shanaibango: "A002", hinmei: "研磨" },
        { shanaibango: "A003", hinmei: "検査" },
        { shanaibango: "A004", hinmei: "組立" },
        { shanaibango: "A005", hinmei: "NC加工" },
        { shanaibango: "A006", hinmei: "MC加工" },
        { shanaibango: "A007", hinmei: "旋盤加工" },
        { shanaibango: "A008", hinmei: "フライス加工" },
        { shanaibango: "A009", hinmei: "仕上げ" },
        { shanaibango: "A010", hinmei: "段取り" },
        { shanaibango: "A011", hinmei: "測定" },
        { shanaibango: "A012", hinmei: "バリ取り" },
        { shanaibango: "A013", hinmei: "洗浄" },
        { shanaibango: "A014", hinmei: "出荷準備" },
        { shanaibango: "A015", hinmei: "材料切断" }
      ];

      const mockKikai = {
        "冨永": ["MC-1", "MC-2", "MC-3"],
        "遠藤": ["Lathe-1", "Lathe-2"],
        "ダン": ["MC-4", "MC-5"],
        "マイン": ["Lathe-3"],
        "ダット": ["MC-6"],
        "ヒエウ": ["MC-7"],
        "タン": ["Lathe-4"],
        "アン": ["MC-8"],
        "ヴォン": ["MC-9"]
      };

      /* -----------------------------
         TẠO 5 DÒNG TRONG BẢNG
      ------------------------------*/

      const tbody = document.getElementById("tableBody");

      for (let i = 0; i < 5; i++) {
        tbody.insertAdjacentHTML(
          "beforeend",
          `
        <tr>
          <td><select class="shanaibango"><option></option></select></td>
          <td><textarea class="naiyo" readonly></textarea></td>
          <td><select class="kikai"><option></option></select></td>
          <td><input type="number" step="0.25" min="0"></td>
        </tr>
      `
        );
      }

      /* -----------------------------
         LOAD MOCK 社内番号
      ------------------------------*/

      document.querySelectorAll(".shanaibango").forEach((select) => {
        mockWork.forEach((row) => {
          const o = document.createElement("option");
          o.value = row.shanaibango;
          o.textContent = row.shanaibango;
          o.dataset.full = row.shanaibango + "｜" + row.hinmei;
          select.appendChild(o);
        });

        select.addEventListener("mousedown", () => {
          [...select.options].forEach(
            (o) => o.dataset.full && (o.textContent = o.dataset.full)
          );
        });

        select.addEventListener("change", () => {
          [...select.options].forEach((o) => (o.textContent = o.value));
          const found = mockWork.find((d) => d.shanaibango === select.value);
          select.closest("tr").querySelector(".naiyo").value = found
            ? found.hinmei
            : "";
        });
      });

      /* -----------------------------
         SET NAME + LOAD MOCK MÁY
      ------------------------------*/

      function setName(name) {
        const box = document.getElementById("nameBox");
        box.innerText = name;
        box.dataset.value = name;

        const machines = mockKikai[name] || [];
        let opt = "<option></option>";
        machines.forEach((m) => (opt += `<option>${m}</option>`));

        document.querySelectorAll(".kikai").forEach((s) => (s.innerHTML = opt));
      }

      /* -----------------------------
         SUBMIT (GIẢ LẬP)
      ------------------------------*/

      function submitNippo() {
        const name = document.getElementById("nameBox").dataset.value;
        const date = document.getElementById("dateInput").value;

        if (!name) return alert("名前を選択してください");
        if (!date) return alert("日付を入力してください");

        const rows = [...document.querySelectorAll("#tableBody tr")].map(
          (tr) => ({
            shanaibango: tr.querySelector(".shanaibango").value,
            naiyo: tr.querySelector(".naiyo").value,
            kikai: tr.querySelector(".kikai").value,
            hour: tr.querySelector("input").value
          })
        );

        alert("保存成功（テストモード）\n\n" + JSON.stringify(rows, null, 2));
      }

      /* -----------------------------
         RESET
      ------------------------------*/

      function resetForm() {
        if (!confirm("リセットしますか？")) return;
        document.getElementById("nippoForm").reset();
        document.getElementById("nameBox").innerText = "";
        document.getElementById("nameBox").dataset.value = "";
      }

      function adminLogin() {
        prompt("管理人パスワード");
      }
    </script>
  </body>
</html>
